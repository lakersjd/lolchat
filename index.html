<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ZeroX - Home</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <div class="container">
    <h1>ZeroX</h1>
    <p>Chat anonymously with strangers around the world.</p>

    <div style="margin-bottom: 10px;">
      <button id="toggleRegion" type="button">ðŸŒŽ Change region manually</button>
    </div>
    <div id="geoMsg" style="margin-bottom: 20px; font-style: italic;"></div>
    <form id="preferenceForm">
      <label>Gender:</label>
      <select id="gender">
        <option value="any">Any</option>
        <option value="male">Male</option>
        <option value="female">Female</option>
      </select><br><br>

      <label>Interest:</label>
      <input type="text" id="interest" placeholder="e.g., gaming, music"><br><br>

      <div id="regionSection" style="display: none;"><label>Region:</label>
      <select id="country">
        <option value="any">Any</option>
        <option value="us">United States</option>
        <option value="uk">United Kingdom</option>
        <option value="ca">Canada</option>
        <option value="au">Australia</option>
        <option value="in">India</option>
        <option value="ph">Philippines</option>
        <option value="za">South Africa</option>
        <option value="ng">Nigeria</option>
        <option value="other">Other</option>
      </select><br><br>
      <label>Language:</label>
      <select id="language" style="display: none;">
        <option value="any">Any</option>
        <option value="en">English</option>
        <option value="es">Spanish</option>
        <option value="fr">French</option>
        <option value="de">German</option>
        <option value="zh">Chinese</option>
      </select></div><br><br>

      <div class="button-group">
        <button type="submit" data-mode="text">Start Text Chat</button>
        <button type="submit" data-mode="video">Start Video Chat</button>
      </div>
    </form>

    <div class="theme-toggle">
      <label>
        <input type="checkbox" id="themeSwitcher" />
        <span>ðŸŒž/ðŸŒ™</span>
      </label>
    </div>
  </div>

  <script>
    const switcher = document.getElementById("themeSwitcher");
    const body = document.body;
    const theme = localStorage.getItem("theme");

    if (theme === "light") {
      body.classList.remove("dark");
    } else {
      body.classList.add("dark");
      switcher.checked = true;
    }

    switcher.addEventListener("change", () => {
      if (switcher.checked) {
        body.classList.add("dark");
        localStorage.setItem("theme", "dark");
      } else {
        body.classList.remove("dark");
        localStorage.setItem("theme", "light");
      }
    });

    const form = document.getElementById("preferenceForm");
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const gender = document.getElementById("gender").value;
      const interest = document.getElementById("interest").value;
      const country = document.getElementById("country").value;
      const language = document.getElementById("language").value;
      const mode = e.submitter.getAttribute("data-mode");
      localStorage.setItem("gender", gender);
      localStorage.setItem("interest", interest);
      localStorage.setItem("language", language);
      localStorage.setItem("country", country);
      window.location.href = `chat.html?mode=${mode}`;
    });
  
// Auto-detect country
fetch('https://get.geojs.io/v1/ip/geo.json')
  .then(res => res.json())
  .then(data => {
    const countryCode = data.country_code?.toLowerCase();
    const select = document.getElementById("country");
    if (countryCode && select) {
      const option = [...select.options].find(o => o.value === countryCode);
      if (option) {
        select.value = countryCode;
        localStorage.setItem("country", countryCode);
      }
    }
  }).catch(() => {}); 

// Auto-detect country + language + display message
const lang = navigator.language || navigator.userLanguage;
localStorage.setItem("language", lang.slice(0, 2).toLowerCase());
document.getElementById("language").value = lang.slice(0, 2).toLowerCase();

fetch('https://get.geojs.io/v1/ip/geo.json')
  .then(res => res.json())
  .then(data => {
    const countryCode = data.country_code?.toLowerCase();
    const countryName = data.country;
    const geoMsg = document.getElementById("geoMsg");
    if (countryCode && countryName) {
      document.getElementById("country").value = countryCode;
      localStorage.setItem("country", countryCode);
      geoMsg.innerText = `ðŸŒ You appear to be in ${countryName} (${countryCode.toUpperCase()})`;
    }
  }).catch(() => {}); 

document.getElementById("toggleRegion")?.addEventListener("click", () => {
  const section = document.getElementById("regionSection");
  section.style.display = section.style.display === "none" ? "block" : "none";
});
</script>
</body>
</html>
