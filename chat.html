<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chat</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>

<div id="sidebarNav" class="sidebar">
  <div class="menu-toggle" onclick="toggleSidebar()">â˜°</div>
  <div class="menu-links" id="menuLinks">
    <a href="/profile">ğŸ‘¤ Profile</a>
    <a href="/friends">ğŸ¤ Friends</a>
    <a href="/login">ğŸ” Login</a>
  
<div style="margin-top:10px;">
  <label style="color:white;">ğŸŒ Language:</label>
  <select id="languageSelect" onchange="setLanguage(this.value)">
    <option value="en">English</option>
    <option value="es">EspaÃ±ol</option>
    <option value="fr">FranÃ§ais</option>
    <option value="de">Deutsch</option>
    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
  </select>
</div>
<script>
  function setLanguage(lang) {
    localStorage.setItem('lang', lang);
    alert("Language set to " + lang + ". (Translation system coming soon!)");
  }
  document.addEventListener("DOMContentLoaded", () => {
    const lang = localStorage.getItem("lang");
    if (lang) {
      document.getElementById("languageSelect").value = lang;
    }
  });
</script>
</div>
</div>
<script>
  function toggleSidebar() {
    document.getElementById("menuLinks").classList.toggle("show");
  }
</script>


<div id="topNav" style="position:fixed;top:0;right:0;background:#333;padding:10px 15px;z-index:999;">
  <a href="/profile" style="color:white;margin-right:10px;">ğŸ‘¤ Profile</a>
  <a href="/friends" style="color:white;margin-right:10px;">ğŸ¤ Friends</a>
  <a href="/login" style="color:white;">ğŸ” Login</a>
</div>

  <div id="topStatus">
    <span id="onlineCount">ğŸŸ¢ Online: 0</span>
    <span id="chatCounter" style="margin-left: 20px;">ğŸ’¬ Chats: 0</span>
    <span id="typingIndicator" style="margin-left: 20px;"></span>
  </div>

  <div class="chat-container" id="chat">
    <div id="textChat" style="display: none;"><img id="strangerAvatar" style="width:40px;height:40px;border-radius:50%;"><br>
      <div id="messages"></div><input type="file" id="fileInput" style="display:none;" />
      <input type="text" id="input" placeholder="Type a message..." />
      <button onclick="sendMessage()">Send</button>
    </div>
    <div id="videoChat" style="display: none;">
      <div id="videoAvatars" style="margin-bottom: 10px;">
      <img id="myVideoAvatar" style="width:40px;height:40px;border-radius:50%;margin-right:10px;">
      <img id="strangerVideoAvatar" style="width:40px;height:40px;border-radius:50%;">
    </div>
    <div class="video-frame">
    <div class="video-controls">
      <button id="muteMicBtn">ğŸ™ï¸ Mute</button>
      <button id="toggleCamBtn">ğŸ“· Off</button>
    </div>
        <video id="localVideo" autoplay muted playsinline></video>
        <video id="remoteVideo" autoplay playsinline></video>
      </div>
    </div>
    <div id="controls">
      
      <button id="skipBtn">Skip</button>
      <button id="reportBtn">âš  Report</button>
      <button id="blockBtn">ğŸš« Block</button>
    </div>
  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script src="script.js"></script>

<script>
  async function simulateTranslation(text, lang) {
    const fakeTranslations = {
      es: " (traducido)",
      fr: " (traduit)",
      de: " (Ã¼bersetzt)",
      ar: " (Ù…ØªØ±Ø¬Ù…)"
    };
    return text + (fakeTranslations[lang] || "");
  }

  async function displayTranslatedMessage(msg, from = "Stranger") {
    const lang = localStorage.getItem("lang") || "en";
    const translated = await simulateTranslation(msg, lang);
    const div = document.createElement("div");
    div.innerHTML = `<b>${from}:</b> ${translated}`;
    document.getElementById("messages")?.appendChild(div);
  }

  // override socket.on message
  if (typeof socket !== "undefined") {
    socket.off("message");
    socket.on("message", async (msg) => {
      await displayTranslatedMessage(msg);
    });

    // override sendMessage to still send normal message
    window.sendMessage = function () {
      const input = document.getElementById("input");
      const msg = input.value;
      if (!msg.trim()) return;
      socket.emit("message", msg);
      displayTranslatedMessage(msg, "You");
      input.value = "";
    };
  }
</script>

</body>
</html>
